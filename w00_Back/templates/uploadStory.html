<!DOCTYPE html>
<html class="h-full bg-white" lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì§„ì„ ê³¨ë¼ì£¼ì„¸ìš”</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="output.css">
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- jQuery Cookie í”ŒëŸ¬ê·¸ì¸ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="app.js" type="module"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dongle&display=swap" rel="stylesheet">

    <script>
        $(document).ready(function () {
            $('#fileInput').change(function (e) {
                alert("ì‚¬ì§„ì˜¬ë¼ê°”ë‹¤!!")
                var file = e.target.files[0]; // ì‚¬ìš©ìê°€ ì„ íƒí•œ íŒŒì¼
                var formData = new FormData();
                formData.append('file', file); // 'file'ì€ ì„œë²„ì—ì„œ íŒŒì¼ì„ ì°¸ì¡°í•˜ëŠ” í‚¤

                var token = $.cookie('mytoken');

                $.ajax({
                    url: '/uploadPhoto', // ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ URL
                    type: 'POST',
                    data: formData,
                    processData: false,  // $.ajaxê°€ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
                    contentType: false,  // ì½˜í…íŠ¸ íƒ€ì… í—¤ë”ë¥¼ ì„¤ì •í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
                    beforeSend: function (xhr) {
                        // ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— í—¤ë”ì— ì¸ì¦ í† í° ì¶”ê°€
                        xhr.setRequestHeader("Authorization", "Bearer " + token);
                    },
                    success: function (data) {
                        alert('Upload success');
                        // ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œëœ í›„ì˜ ì²˜ë¦¬ ë¡œì§ì„ ì—¬ê¸°ì— ì‘ì„±
                        window.location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('Upload failed');
                        // ì—…ë¡œë“œ ì‹¤íŒ¨ì‹œì˜ ì²˜ë¦¬ ë¡œì§ì„ ì—¬ê¸°ì— ì‘ì„±
                    }
                });
            });
        });
    </script>

</head>

<body class="h-full">
    <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-sm">
            <h5 class="mt-10 text-center text-2xl font-semibold tracking-tight text-gray-700 font-custom">{id}ë‹˜ ë°˜ê°€ì›Œìš”!
            </h5>
            <h3 class="mt-2 text-center text-2xl font-semibold tracking-tight text-gray-700 font-custom">ì‚¬ì§„ì„ ê³ ë¥´ë©´ ì´ì•¼ê¸°ë¥¼
                ë§Œë“¤ì–´ë“œë¦´ê²Œìš”<br>ğŸ¤­ğŸ¥³</h3>
            <div class="flex justify-center items-center">
                <input type="file" id="fileInput" class="hidden" />
                <label for="fileInput">
                    <div class="w-24 h-24 rounded-full flex justify-center items-center cursor-pointer">
                        <div
                            class="circle my-10 flex justify-center bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                            ì‚¬ì§„ ì˜¬ë¦¬ê¸°</div>
                    </div>
                </label>
            </div>
        </div>

        <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
            {% for data in storyData %}
            <div>
                <img src="data:image/png;base64,{{ data.img_src }}" alt="Uploaded Image">
                <p>{{ data.text }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
            <div>
                <button type="submit"
                    class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">ë‹¤ë¥¸
                    ì´ì•¼ê¸° ë³´ëŸ¬ê°€ê¸°</button>
            </div>
        </div>
    </div>
</body>

</html>